# AI 분석 모듈 구조 설계

7개 분석 탭 메뉴에 대한 독립적 서비스 모듈 스켈레톤 구조

**생성일**: 2026-01-28  
**상태**: 1차 스켈레톤 완료 (구현 대기)

---

## 모듈 구조 개요

```
src/services/analysis/
├── summary/              # 요약
├── analyst/              # 애널리스트
├── trading-strategy/     # 매매전략
├── exit-timing/          # 매도타이밍
├── accumulation/         # 추가매수
├── holding-period/       # 보유기간
├── risk-control/         # 익절/손절
└── index.ts              # 통합 export
```

각 모듈은 동일한 계층 구조:

| 계층           | 역할                          |
| ------------ | --------------------------- |
| `agent/`     | AI/LLM 호출 오케스트레이션, Skill 조합 |
| `skills/`    | 단일 책임 분석 기능                 |
| `service.ts` | 컴포넌트 진입점                    |
| `index.ts`   | 모듈 export                   |

---

## 모듈별 역할

| 모듈                   | 역할              | Agent              | Skills                                               |
| -------------------- | --------------- | ------------------ | ---------------------------------------------------- |
| **summary**          | 성과 평가, 밸류에이션    | SummaryAgent       | PerformanceEvaluator, CharacteristicsAnalyzer        |
| **analyst**          | 리포트 수집/요약, 컨센서스 | AnalystAgent       | ReportCrawler, ConsensusCalculator, ReportSummarizer |
| **trading-strategy** | 전략 생성, 백테스트     | StrategyAgent      | MarketAnalyzer, BacktestRunner, StrategyGenerator    |
| **exit-timing**      | 매도 신호, 분할 매도    | ExitTimingAgent    | SignalDetector, ExitPlanGenerator                    |
| **accumulation**     | 매수 신호, 분할 매수    | AccumulationAgent  | BuySignalDetector, PositionCalculator                |
| **holding-period**   | 이벤트 스케줄, 기간 추천  | HoldingPeriodAgent | EventScheduler, PeriodRecommender                    |
| **risk-control**     | 손절가, 트레일링 스탑    | RiskControlAgent   | StopLossCalculator, TrailingStopManager              |

---

## 공통 타입

`src/types/analysis.ts`에 추가된 타입:

```typescript
// Agent 인터페이스
interface BaseAgent<TInput, TOutput> {
    analyze(input: TInput): Promise<TOutput>;
}

// Skill 인터페이스
interface BaseSkill<TInput, TOutput> {
    execute(input: TInput): Promise<TOutput>;
}

// 분석 컨텍스트
interface AnalysisContext {
    stockCode: string;
    stockName: string;
    currentPrice: number;
    purchasePrice: number;
    quantity: number;
    portfolioId?: string;
    userId?: string;
}
```

---

## 사용 예시

```typescript
import { 
    summaryAnalysisService,
    analystAnalysisService,
    tradingStrategyService,
} from "@/services/analysis";

// 요약 분석
const summary = await summaryAnalysisService.getSummaryAnalysis(context);

// 애널리스트 분석
const analyst = await analystAnalysisService.getAnalystInsight(context);

// 매매 전략 분석
const strategy = await tradingStrategyService.getTradingStrategy(context);
```

---

## 개발 우선순위

의존성 기반 개발 순서:

1. `analyst` → 2. `summary` → 3. `trading-strategy`
2. `exit-timing` / `accumulation` / `holding-period` (병렬)
3. `risk-control`

자세한 개발 파이프라인은 [AI_Analysis_workflow.md](./AI_Analysis_workflow.md) 참조

---

## 파일 목록 (37개)

<details>
<summary>전체 목록 보기</summary>

### summary/ (5개)

- `agent/summary-agent.ts`
- `skills/performance-evaluator.ts`
- `skills/characteristics-analyzer.ts`
- `service.ts`
- `index.ts`

### analyst/ (6개)

- `agent/analyst-agent.ts`
- `skills/report-crawler.ts`
- `skills/consensus-calculator.ts`
- `skills/report-summarizer.ts`
- `service.ts`
- `index.ts`

### trading-strategy/ (6개)

- `agent/strategy-agent.ts`
- `skills/market-analyzer.ts`
- `skills/backtest-runner.ts`
- `skills/strategy-generator.ts`
- `service.ts`
- `index.ts`

### exit-timing/ (5개)

- `agent/exit-timing-agent.ts`
- `skills/signal-detector.ts`
- `skills/exit-plan-generator.ts`
- `service.ts`
- `index.ts`

### accumulation/ (5개)

- `agent/accumulation-agent.ts`
- `skills/buy-signal-detector.ts`
- `skills/position-calculator.ts`
- `service.ts`
- `index.ts`

### holding-period/ (5개)

- `agent/holding-period-agent.ts`
- `skills/event-scheduler.ts`
- `skills/period-recommender.ts`
- `service.ts`
- `index.ts`

### risk-control/ (5개)

- `agent/risk-control-agent.ts`
- `skills/stop-loss-calculator.ts`
- `skills/trailing-stop-manager.ts`
- `service.ts`
- `index.ts`

</details>
