![](C:\Users\ikaros\AppData\Roaming\marktext\images\2026-01-28-01-48-15-image.png)

<img src="file:///C:/Users/ikaros/AppData/Roaming/marktext/images/2026-01-28-02-12-52-image.png" title="" alt="" width="290">

# 분석 모듈 스켈레톤 구조 설계 - 구현 계획

7개 분석 탭 메뉴에 대한 독립적 서비스 모듈 구조 설계 및 1차 스켈레톤 생성

**작성일**: 2026-01-28  
**상태**: ✅ 스켈레톤 생성 완료

---

## 제안된 변경 사항

### 1. 새로운 모듈 디렉토리 구조

기존 `src/services/analysis/` 하위에 7개 탭별 독립 모듈 폴더 생성

```
src/services/analysis/
├── summary/                    # 요약 모듈
│   ├── agent/
│   │   └── summary-agent.ts
│   ├── skills/
│   │   ├── performance-evaluator.ts
│   │   └── characteristics-analyzer.ts
│   ├── service.ts
│   └── index.ts
│
├── analyst/                    # 애널리스트 모듈
│   ├── agent/
│   │   └── analyst-agent.ts
│   ├── skills/
│   │   ├── report-crawler.ts
│   │   ├── consensus-calculator.ts
│   │   └── report-summarizer.ts
│   ├── service.ts
│   └── index.ts
│
├── trading-strategy/           # 매매전략 모듈
│   ├── agent/
│   │   └── strategy-agent.ts
│   ├── skills/
│   │   ├── market-analyzer.ts
│   │   ├── backtest-runner.ts
│   │   └── strategy-generator.ts
│   ├── service.ts
│   └── index.ts
│
├── exit-timing/                # 매도타이밍 모듈
│   ├── agent/
│   │   └── exit-timing-agent.ts
│   ├── skills/
│   │   ├── signal-detector.ts
│   │   └── exit-plan-generator.ts
│   ├── service.ts
│   └── index.ts
│
├── accumulation/               # 추가매수 모듈
│   ├── agent/
│   │   └── accumulation-agent.ts
│   ├── skills/
│   │   ├── buy-signal-detector.ts
│   │   └── position-calculator.ts
│   ├── service.ts
│   └── index.ts
│
├── holding-period/             # 보유기간 모듈
│   ├── agent/
│   │   └── holding-period-agent.ts
│   ├── skills/
│   │   ├── event-scheduler.ts
│   │   └── period-recommender.ts
│   ├── service.ts
│   └── index.ts
│
├── risk-control/               # 익절/손절 모듈
│   ├── agent/
│   │   └── risk-control-agent.ts
│   ├── skills/
│   │   ├── stop-loss-calculator.ts
│   │   └── trailing-stop-manager.ts
│   ├── service.ts
│   └── index.ts
│
├── index.ts                    # 통합 export
└── [기존 엔진 파일들 유지]     # 마이그레이션 이후 deprecate 예정
```

---

### 2. 공통 타입 및 인터페이스

[analysis.ts](./types/analysis.ts)에 추가된 Agent/Skill 관련 공통 타입:

```typescript
// Agent 기본 인터페이스
export interface BaseAgent<TInput, TOutput> {
  analyze(input: TInput): Promise<TOutput>;
}

// Skill 기본 인터페이스
export interface BaseSkill<TInput, TOutput> {
  execute(input: TInput): Promise<TOutput>;
}

// 분석 컨텍스트 (공통 입력)
export interface AnalysisContext {
  stockCode: string;
  stockName: string;
  currentPrice: number;
  purchasePrice: number;
  quantity: number;
  portfolioId?: string;
  userId?: string;
}
```

---

### 3. 각 모듈별 계층 구조

| 계층             | 파일명                 | 역할                                |
| -------------- | ------------------- | --------------------------------- |
| **agent/**     | `{module}-agent.ts` | 외부 AI/LLM 호출 오케스트레이션, 다수 Skill 조합 |
| **skills/**    | `*.ts`              | 단일 책임 분석 기능 (기술적 분석, 데이터 크롤링 등)   |
| **service.ts** | -                   | 컴포넌트에서 호출하는 메인 서비스 클래스            |
| **index.ts**   | -                   | 모듈 export 집약                      |

---

### 4. 각 모듈별 역할 요약

| 탭     | 모듈명                | 역할                                       |
| ----- | ------------------ | ---------------------------------------- |
| 요약    | `summary`          | 현재 성과 평가, 목표가 진행률, 종목 특성, 밸류에이션 종합       |
| 애널리스트 | `analyst`          | 증권사 리포트 수집, AI 요약, 컨센서스 계산, 애널리스트 정확도 추적 |
| 매매전략  | `trading-strategy` | 투자 성향별 전략, 시장 상황 분석, 백테스트, 매수/매도 신호      |
| 매도타이밍 | `exit-timing`      | 목표가 도달 감지, 기술적 매도 신호, 분할 매도 전략           |
| 추가매수  | `accumulation`     | 기술적 매수 시점, 수급 개선 신호, 분할 매수 계획            |
| 보유기간  | `holding-period`   | 투자 목적별 권장 기간, 실적 발표 일정, 체크포인트 알림         |
| 익절/손절 | `risk-control`     | 익절/손절 라인 계산, 트레일링 스탑, 실시간 모니터링           |

> [!IMPORTANT]
> 기존 엔진 파일(`summary-engine.ts`, `exit-timing-engine.ts`, `risk-control-engine.ts`)은 즉시 삭제하지 않고 유지. 새 모듈 구조 완성 후 점진적으로 마이그레이션 예정.

---

## 전체 개발 파이프라인

7개 서비스 모듈 개발을 위한 단계별 개발 순서 (데이터 수집 → 서비스 구현)

### Phase 0: 데이터 인프라 (선행 필수)

```
[데이터 수집]
├─ KIS Open API 연동 → 실시간 시세, 호가, 체결
├─ 네이버 금융 크롤링 → 재무제표, 밸류에이션
├─ DART 공시 수집 → 공시 정보, 재무 데이터
├─ 증권사 리포트 크롤링 → 애널리스트 리포트
└─ 뉴스 데이터 수집 → 센티먼트 분석용

[데이터 저장]
└─ Firestore 스키마 설계 → 종목, 리포트, 전략, 신호 컬렉션
```

### Phase 1: 백엔드 개발 (Cloud Functions)

```
[스케줄러]
├─ 일일 데이터 수집 (09:00 KST)
├─ 리포트 크롤링 (20:00 KST)
└─ 기술적 지표 계산 (매 분)

[트리거]
├─ onPriceUpdate → 신호 감지, 익절/손절 체크
├─ onNewReport → AI 요약 생성
└─ onSignalDetected → 알림 전송 (FCM)
```

### Phase 2: AI 엔진 개발 (Cloud Run - Python)

```
[FastAPI 서버]
├─ /summarize-report → Claude API, 리포트 요약
├─ /backtest → 전략 백테스트 엔진
├─ /generate-strategy → 전략 생성 AI
└─ /generate-summary → 종합 리포트 생성

[기술 스택]
├─ Claude API (Anthropic) → 텍스트 분석, 요약
├─ TA-Lib → 기술적 지표 계산
├─ Backtrader → 백테스트 엔진
└─ PyPortfolioOpt → 포트폴리오 최적화
```

### Phase 3: 서비스 모듈 개발 순서

```
[개발 순서] (의존성 기반)

1️⃣ analyst (애널리스트) ─────────┐
   └─ 리포트 수집, AI 요약, 컨센서스  │
                                    ├─→ 3️⃣ trading-strategy (매매전략)
2️⃣ summary (요약) ───────────────┘    └─ 전략 생성, 백테스트, 신호 감지
   └─ 성과 평가, 밸류에이션
                                          │
                    ┌─────────────────────┴─────────────────────┐
                    ↓                     ↓                     ↓
           4️⃣ exit-timing        5️⃣ accumulation       6️⃣ holding-period
           (매도타이밍)            (추가매수)              (보유기간)
           └─ 매도 신호, 분할 매도  └─ 매수 신호, 분할 매수  └─ 이벤트, 기간 추천
                    │                     │                     │
                    └─────────────────────┴─────────────────────┘
                                          ↓
                                   7️⃣ risk-control (익절/손절)
                                   └─ 손절선, 트레일링 스탑, 알림
```

### Phase 4: 프론트엔드 연동

```
[컴포넌트 연동]
├─ 각 탭 컴포넌트 ↔ 서비스 모듈 연결
├─ Firestore 실시간 리스너 적용
└─ FCM 푸시 알림 수신

[상태 관리]
└─ Zustand 스토어 확장
```

### Phase 5: 통합 및 검증

```
[테스트]
├─ 단위 테스트 (각 Skill)
├─ 통합 테스트 (Agent + Service)
└─ E2E 테스트 (전체 파이프라인)

[모니터링]
├─ Cloud Logging → 에러 추적
├─ Performance Monitoring → 응답 시간
└─ Rate Limit 관리 → API 요청 제한
```

---

## 스켈레톤 구현 완료 보고

### 1. 수행 작업 요약

- **공통 타입 추가**: `src/types/analysis.ts`에 `BaseAgent`, `BaseSkill`, `AnalysisContext` 추가
- **7개 모듈 스켈레톤 생성**: 총 37개 파일 생성 완료 (Agent, Skills, Service, Index)
- **통합 index 업데이트**: `src/services/analysis/index.ts`에 새 모듈 명시적 export 추가 (이름 충돌 방지)

### 2. 모듈 생성 통계

| 모듈                      | 파일 수 | Agent              | Skills |
| ----------------------- | ---- | ------------------ | ------ |
| 요약 (summary)            | 5    | SummaryAgent       | 2      |
| 애널리스트 (analyst)         | 6    | AnalystAgent       | 3      |
| 매매전략 (trading-strategy) | 6    | StrategyAgent      | 3      |
| 매도타이밍 (exit-timing)     | 5    | ExitTimingAgent    | 2      |
| 추가매수 (accumulation)     | 5    | AccumulationAgent  | 2      |
| 보유기간 (holding-period)   | 5    | HoldingPeriodAgent | 2      |
| 익절/손절 (risk-control)    | 5    | RiskControlAgent   | 2      |

### 3. 검증 결과

- **TypeScript**: `npx tsc --noEmit` 실행 결과 오류 없음 (✅ 통과)
- **문서화**: `docs/analysis_module_structure.md`에 세부 구조 기록 완료

---



## 파일 목록 (상세)

### 신규 생성 파일 (37개)

<details>
<summary>전체 목록 보기</summary>

#### summary/ (5개)

1. `src/services/analysis/summary/agent/summary-agent.ts`
2. `src/services/analysis/summary/skills/performance-evaluator.ts`
3. `src/services/analysis/summary/skills/characteristics-analyzer.ts`
4. `src/services/analysis/summary/service.ts`
5. `src/services/analysis/summary/index.ts`

#### analyst/ (6개)

6. `src/services/analysis/analyst/agent/analyst-agent.ts`
7. `src/services/analysis/analyst/skills/report-crawler.ts`
8. `src/services/analysis/analyst/skills/consensus-calculator.ts`
9. `src/services/analysis/analyst/skills/report-summarizer.ts`
10. `src/services/analysis/analyst/service.ts`
11. `src/services/analysis/analyst/index.ts`

#### trading-strategy/ (6개)

12. `src/services/analysis/trading-strategy/agent/strategy-agent.ts`
13. `src/services/analysis/trading-strategy/skills/market-analyzer.ts`
14. `src/services/analysis/trading-strategy/skills/backtest-runner.ts`
15. `src/services/analysis/trading-strategy/skills/strategy-generator.ts`
16. `src/services/analysis/trading-strategy/service.ts`
17. `src/services/analysis/trading-strategy/index.ts`

#### exit-timing/ (5개)

18. `src/services/analysis/exit-timing/agent/exit-timing-agent.ts`
19. `src/services/analysis/exit-timing/skills/signal-detector.ts`
20. `src/services/analysis/exit-timing/skills/exit-plan-generator.ts`
21. `src/services/analysis/exit-timing/service.ts`
22. `src/services/analysis/exit-timing/index.ts`

#### accumulation/ (5개)

23. `src/services/analysis/accumulation/agent/accumulation-agent.ts`
24. `src/services/analysis/accumulation/skills/buy-signal-detector.ts`
25. `src/services/analysis/accumulation/skills/position-calculator.ts`
26. `src/services/analysis/accumulation/service.ts`
27. `src/services/analysis/accumulation/index.ts`

#### holding-period/ (5개)

28. `src/services/analysis/holding-period/agent/holding-period-agent.ts`
29. `src/services/analysis/holding-period/skills/event-scheduler.ts`
30. `src/services/analysis/holding-period/skills/period-recommender.ts`
31. `src/services/analysis/holding-period/service.ts`
32. `src/services/analysis/holding-period/index.ts`

#### risk-control/ (5개)

33. `src/services/analysis/risk-control/agent/risk-control-agent.ts`
34. `src/services/analysis/risk-control/skills/stop-loss-calculator.ts`
35. `src/services/analysis/risk-control/skills/trailing-stop-manager.ts`
36. `src/services/analysis/risk-control/service.ts`
37. `src/services/analysis/risk-control/index.ts`

</details>

### 수정 파일 (2개)

1. `src/services/analysis/index.ts` - 새 모듈 export 추가
2. `src/types/analysis.ts` - Agent/Skill 공통 타입 추가
